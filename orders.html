<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Orders - GoKit.ME</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <i class="fas fa-futbol"></i>
                GoKit.ME
            </a>
            <nav class="nav-links">
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Search jerseys..." id="searchInput">
                </div>
                <a href="index.html" class="nav-link">Home</a>
                <a href="index.html#products" class="nav-link">Jerseys</a>
                <a href="index.html#leagues" class="nav-link">Leagues</a>
                <a href="index.html#sale" class="nav-link">Sale</a>
                <a href="index.html#contact" class="nav-link">Contact</a>
                <div class="user-account">
                    <button class="account-btn" onclick="toggleAccountDropdown()">
                        <i class="fas fa-user-check"></i>
                    </button>
                    <div class="account-dropdown" id="accountDropdown">
                        <h3 id="accountName">My Account</h3>
                        <ul>
                            <li><a href="profile.html">Profile</a></li>
                            <li><a href="orders.html" class="active">Orders</a></li>
                            <li><a href="wishlist.html">Wishlist</a></li>
                            <li><a href="settings.html">Settings</a></li>
                        </ul>
                        <button class="logout-btn" onclick="logout()">Logout</button>
                    </div>
                </div>
                <button class="dark-mode-toggle" onclick="toggleDarkMode()">
                    <i class="fas fa-moon"></i>
                </button>
            </nav>
        </div>
    </header>

    <!-- Orders Section -->
    <section class="account-section">
        <div class="container">
            <div class="account-container">
                <!-- Sidebar -->
                <div class="account-sidebar">
                    <div class="account-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="account-nav">
                        <a href="profile.html" class="account-nav-item">
                            <i class="fas fa-user"></i> Profile
                        </a>
                        <a href="orders.html" class="account-nav-item active">
                            <i class="fas fa-shopping-bag"></i> Orders
                        </a>
                        <a href="wishlist.html" class="account-nav-item">
                            <i class="fas fa-heart"></i> Wishlist
                        </a>
                        <a href="settings.html" class="account-nav-item">
                            <i class="fas fa-cog"></i> Settings
                        </a>
                    </div>
                </div>

                <!-- Content -->
                <div class="account-content">
                    <h1 class="account-title">My Orders</h1>

                    <div id="ordersContainer" class="orders-container">
                        <div class="loading-spinner-large"></div>
                    </div>

                    <div id="noOrdersMessage" style="display: none; text-align: center; padding: 2rem;">
                        <i class="fas fa-shopping-bag" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                        <h3>No orders yet</h3>
                        <p>You haven't placed any orders yet.</p>
                        <a href="index.html" class="primary-btn" style="display: inline-block; margin-top: 1rem;">Start
                            Shopping</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>GoKit.ME</h3>
                    <p>Your premier destination for premium football jerseys from teams around the world.</p>
                    <div class="social-links">
                        <a href="#" class="social-link"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="index.html#products">Jerseys</a></li>
                        <li><a href="index.html#leagues">Leagues</a></li>
                        <li><a href="index.html#sale">Sale</a></li>
                        <li><a href="index.html#contact">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Customer Service</h3>
                    <ul>
                        <li><a href="#" onclick="openSizeChart(); return false;">Size Guide</a></li>
                        <li><a href="#">Shipping Info</a></li>
                        <li><a href="#">Returns & Exchanges</a></li>
                        <li><a href="#">Payment Methods</a></li>
                        <li><a href="#">FAQ</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Newsletter</h3>
                    <p>Subscribe to receive updates on new arrivals and special offers</p>
                    <div style="display: flex; margin-top: 1rem;">
                        <input type="email" placeholder="Your email"
                            style="flex: 1; padding: 0.8rem; border: none; border-radius: 5px 0 0 5px;">
                        <button
                            style="background: #3498db; color: white; border: none; padding: 0.8rem; border-radius: 0 5px 5px 0; cursor: pointer;">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>Â© 2025 GoKit.ME. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAbMf3bPs97pkfXUKB_44rKoRWmvt9b0yM",
            authDomain: "gokit-x-courtdripdxb.firebaseapp.com",
            projectId: "gokit-x-courtdripdxb",
            storageBucket: "gokit-x-courtdripdxb.firebasestorage.app",
            messagingSenderId: "384570406205",
            appId: "1:384570406205:web:966041b461575405b74154"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Check if user is logged in
        document.addEventListener('DOMContentLoaded', function () {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // User is logged in, load their orders
                    document.getElementById('accountName').textContent = `Hi, ${user.displayName || 'User'}`;
                    loadUserOrders(user.uid);
                } else {
                    // User is not logged in, redirect to home
                    window.location.href = "index.html";
                }
            });
        });

        // Load user orders
        function loadUserOrders(userId) {
            db.collection("orders")
                .where("userId", "==", userId)
                .orderBy("createdAt", "desc")
                .get()
                .then((querySnapshot) => {
                    const ordersContainer = document.getElementById('ordersContainer');
                    ordersContainer.innerHTML = ''; // Clear loading spinner

                    if (querySnapshot.empty) {
                        // No orders found
                        document.getElementById('noOrdersMessage').style.display = 'block';
                        return;
                    }

                    // Display each order
                    querySnapshot.forEach((doc) => {
                        const order = doc.data();
                        const orderElement = createOrderElement(doc.id, order);
                        ordersContainer.appendChild(orderElement);
                    });
                })
                .catch((error) => {
                    console.error("Error loading orders: ", error);
                    ordersContainer.innerHTML = `
                        <div class="error-message">
                            <i class="fas fa-exclamation-circle"></i>
                            <p>Error loading orders. Please try again later.</p>
                        </div>
                    `;
                });
        }

        // Create HTML for an order
        function createOrderElement(orderId, order) {
            const orderElement = document.createElement('div');
            orderElement.className = 'order-card';

            // Format date
            const orderDate = order.createdAt ? new Date(order.createdAt.toDate()) : new Date();
            const formattedDate = orderDate.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            // Create status badge class
            const statusClass = `status-${(order.status || 'pending').toLowerCase()}`;

            // Create products list HTML
            let productsHtml = '<ul class="order-items-list">';
            if (order.products && order.products.length) {
                order.products.forEach(product => {
                    productsHtml += `
                        <li class="order-item">
                            <div class="order-item-name">${product.name || 'Product'}</div>
                            <div class="order-item-quantity">x${product.quantity || 1}</div>
                            <div class="order-item-price">AED ${(product.price || 0).toFixed(2)}</div>
                        </li>
                    `;
                });
            } else {
                productsHtml += `
                    <li class="order-item">
                        <div class="order-item-name">Order details</div>
                    </li>
                `;
            }
            productsHtml += '</ul>';

            orderElement.innerHTML = `
                <div class="order-header">
                    <div class="order-id">Order #${orderId.substring(0, 8)}</div>
                    <div class="order-date">${formattedDate}</div>
                </div>
                <div class="order-status ${statusClass}">${order.status || 'Pending'}</div>
                <div class="order-items">
                    ${productsHtml}
                </div>
                <div class="order-footer">
                    <div class="order-total">Total: AED ${(order.totalPrice || 0).toFixed(2)}</div>
                    <button class="order-details-btn" onclick="viewOrderDetails('${orderId}')">
                        View Details
                    </button>
                </div>
            `;

            return orderElement;
        }

        // View order details
        function viewOrderDetails(orderId) {
            alert(`View details for order ${orderId}`);
            // In a real app, you would show a modal with more details or navigate to a dedicated page
        }

        // Logout function
        function logout() {
            auth.signOut()
                .then(() => {
                    window.location.href = "index.html";
                })
                .catch((error) => {
                    console.error("Error signing out: ", error);
                });
        }

        // Toggle account dropdown
        function toggleAccountDropdown() {
            document.getElementById('accountDropdown').classList.toggle('show');
        }

        // Toggle dark mode
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);

            const icon = document.querySelector('.dark-mode-toggle i');
            icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
        }

        // Load dark mode preference
        document.addEventListener('DOMContentLoaded', function () {
            const savedDarkMode = localStorage.getItem('darkMode') === 'true';
            if (savedDarkMode) {
                document.body.classList.add('dark-mode');
                document.querySelector('.dark-mode-toggle i').className = 'fas fa-sun';
            }

            // Close account dropdown when clicking outside
            document.addEventListener('click', function (event) {
                const dropdown = document.getElementById('accountDropdown');
                const accountBtn = document.querySelector('.account-btn');

                if (!accountBtn.contains(event.target) && !dropdown.contains(event.target)) {
                    dropdown.classList.remove('show');
                }
            });
        });
    </script>
</body>

</html>