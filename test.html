<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoKit.ME - Premium Football Jerseys</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Light Theme */
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #e2e8f0;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --text-inverse: #ffffff;
            --accent-neon: #00ff88;
            --accent-blue: #3b82f6;
            --accent-purple: #8b5cf6;
            --accent-gold: #d4af37;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-elevated: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;
            --space-16: 4rem;
            --space-20: 5rem;
            --text-xs: 0.75rem;
            --text-sm: 0.875rem;
            --text-base: 1rem;
            --text-lg: 1.125rem;
            --text-xl: 1.25rem;
            --text-2xl: 1.5rem;
            --text-3xl: 1.875rem;
            --text-4xl: 2.25rem;
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        /* Dark Theme */
        body.dark {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border-color: #334155;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: all var(--transition-normal);
        }

        /* Prevent body scroll when modal is open */
        body.modal-open {
            overflow: hidden;
        }

        /* Header Styles */
        .header {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-4) var(--space-6);
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: var(--text-2xl);
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-neon), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-4);
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: var(--text-sm);
        }

        .btn-primary {
            background: var(--accent-neon);
            color: var(--text-primary);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .btn-ghost:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        /* Page Actions Buttons */
        .page-actions-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-4) var(--space-6);
        }

        .page-action-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            transition: all var(--transition-fast);
        }

        .page-action-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Account Dropdown */
        .account-dropdown {
            position: relative;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-elevated);
            min-width: 250px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all var(--transition-fast);
            z-index: 1000;
            margin-top: var(--space-2);
        }

        .dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-header {
            padding: var(--space-4);
            border-bottom: 1px solid var(--border-color);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            color: var(--text-secondary);
            text-decoration: none;
            transition: all var(--transition-fast);
        }

        .dropdown-item:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        /* Search Section */
        .search-section {
            background: var(--bg-secondary);
            padding: var(--space-8) var(--space-6);
        }

        .search-container {
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }

        .search-title {
            font-size: var(--text-3xl);
            font-weight: 800;
            margin-bottom: var(--space-4);
            background: linear-gradient(135deg, var(--accent-neon), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .search-input-container {
            position: relative;
            margin-bottom: var(--space-6);
        }

        .search-input {
            width: 100%;
            padding: var(--space-4) var(--space-6);
            padding-left: var(--space-12);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-xl);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: var(--text-lg);
            transition: all var(--transition-fast);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-neon);
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.1);
        }

        .search-icon {
            position: absolute;
            left: var(--space-4);
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: var(--text-lg);
        }

        /* Autocomplete Search Dropdown */
        .search-results-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 var(--radius-xl) var(--radius-xl);
            box-shadow: var(--shadow-lg);
            z-index: 99;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            /* Hidden by default */
        }

        .search-result-item {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            padding: var(--space-3) var(--space-4);
            cursor: pointer;
            transition: background var(--transition-fast);
            text-decoration: none;
            color: var(--text-primary);
        }

        .search-result-item:hover {
            background: var(--bg-secondary);
        }

        .search-result-image {
            font-size: 1.5rem;
            width: 30px;
            text-align: center;
        }

        /* Size Guide Button */
        .size-guide-container {
            display: flex;
            justify-content: center;
            margin-top: var(--space-6);
            margin-bottom: var(--space-4);
        }

        .size-guide-btn {
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 2px solid var(--accent-gold);
            padding: var(--space-3) var(--space-6);
            border-radius: var(--radius-lg);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--space-2);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .size-guide-btn:hover {
            background: var(--accent-gold);
            color: var(--bg-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Products Grid - Mobile Optimized */
        .products-section {
            padding: var(--space-8) var(--space-4);
            max-width: 1200px;
            margin: 0 auto;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-6);
            margin-top: var(--space-8);
        }

        /* Mobile: 2 columns */
        @media (max-width: 768px) {
            .products-section {
                padding: var(--space-6) var(--space-3);
            }
        }

        /* Small mobile: still 2 columns but smaller */

        .product-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            overflow: hidden;
            transition: all var(--transition-normal);
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-elevated);
            border-color: var(--accent-neon);
        }

        .product-image-container {
            position: relative;
            padding: var(--space-8);
            background: var(--bg-secondary);
            text-align: center;
        }

        .product-image {
            font-size: 4rem;
            margin-bottom: var(--space-4);
        }

        .product-badge {
            position: absolute;
            top: var(--space-3);
            right: var(--space-3);
            background: var(--accent-neon);
            color: var(--text-primary);
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: 600;
        }

        .product-actions {
            position: absolute;
            top: var(--space-3);
            left: var(--space-3);
            display: flex;
            gap: var(--space-2);
            opacity: 1;
            /* Always visible now */
            transition: all var(--transition-fast);
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: var(--radius-md);
            background: rgba(0, 0, 0, 0.7);
            /* Darker background for better visibility */
            color: white;
            /* White icon for better contrast */
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .action-btn:hover {
            background: var(--accent-neon);
            transform: scale(1.1);
        }

        .action-btn.active {
            background: var(--accent-neon);
            color: var(--text-primary);
        }

        .product-info {
            padding: var(--space-4);
        }

        .product-team {
            color: var(--text-muted);
            font-size: var(--text-sm);
            margin-bottom: var(--space-2);
        }

        .product-name {
            font-size: var(--text-lg);
            font-weight: 700;
            margin-bottom: var(--space-3);
            color: var(--text-primary);
        }

        .product-pricing {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
            flex-wrap: wrap;
        }

        .product-price {
            font-size: var(--text-xl);
            font-weight: 800;
            color: var(--accent-neon);
        }

        .product-original-price {
            font-size: var(--text-sm);
            color: var(--text-muted);
            text-decoration: line-through;
        }

        .product-discount {
            background: rgba(0, 255, 136, 0.1);
            color: var(--accent-neon);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: 600;
        }

        /* Chatbot Styles */
        .chatbot-container {
            position: fixed;
            bottom: var(--space-6);
            right: var(--space-6);
            z-index: 1000;
        }

        .chatbot-toggle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--accent-neon);
            color: var(--text-primary);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-xl);
            box-shadow: var(--shadow-elevated);
            transition: all var(--transition-fast);
        }


        .chatbot-launcher {
            position: relative;
            display: flex;
            align-items: flex-end;
            gap: var(--space-3);
        }

        .chatbot-greeting {
            background: var(--bg-secondary);
            color: var(--text-primary);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            opacity: 0;
            transform: translateY(10px);
            white-space: nowrap;
        }

        /* Skeleton Loader */
        .skeleton-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        .skeleton-image {
            height: 200px;
            background: var(--bg-tertiary);
            animation: pulse 1.5s infinite ease-in-out;
        }

        .skeleton-info {
            padding: var(--space-4);
        }

        .skeleton-line {
            height: 1rem;
            margin-bottom: var(--space-3);
            border-radius: var(--radius-sm);
            background: var(--bg-tertiary);
            animation: pulse 1.5s infinite ease-in-out;
        }

        .skeleton-line.short {
            width: 60%;
        }

        .skeleton-line.long {
            width: 90%;
        }

        .skeleton-button {
            height: 40px;
            border-radius: var(--radius-md);
            background: var(--bg-tertiary);
            animation: pulse 1.5s infinite ease-in-out;
            margin-top: var(--space-4);
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }





        .chatbot-toggle:hover {
            transform: scale(1.1);
        }

        .chatbot-window {
            position: absolute;
            bottom: 80px;
            right: 0;
            width: 350px;
            height: 500px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-elevated);
            display: flex;
            flex-direction: column;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all var(--transition-normal);
        }

        .chatbot-window.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .chatbot-header {
            padding: var(--space-4);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-secondary);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }

        .chatbot-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: var(--space-2);
            font-size: var(--text-lg);
        }

        .modal-close:hover {
            color: var(--text-primary);
        }

        .chatbot-messages {
            flex: 1;
            padding: var(--space-4);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .message {
            display: flex;
            gap: var(--space-3);
            align-items: flex-start;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-sm);
            flex-shrink: 0;
        }

        .message-content {
            background: var(--bg-secondary);
            padding: var(--space-3);
            border-radius: var(--radius-md);
            max-width: 80%;
            font-size: var(--text-sm);
            line-height: 1.5;
        }

        .message.user .message-content {
            background: var(--accent-neon);
            color: var(--text-primary);
        }

        .chatbot-input {
            padding: var(--space-4);
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: var(--space-2);
        }

        .chatbot-input input {
            flex: 1;
            padding: var(--space-3);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .chatbot-send {
            padding: var(--space-3);
            background: var(--accent-neon);
            color: var(--text-primary);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
        }

        /* Modal Styles - Fixed scrolling issue */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
            padding: var(--space-4);
            overflow-y: auto;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            margin: auto;
        }

        .modal-header {
            padding: var(--space-6);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            background: var(--bg-primary);
            z-index: 10;
        }

        .modal-body {
            padding: var(--space-6);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: var(--space-4);
        }

        .form-label {
            display: block;
            margin-bottom: var(--space-2);
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: var(--space-3);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all var(--transition-fast);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-neon);
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.1);
        }

        /* Size Guide Modal */
        .size-guide-modal .modal-content {
            max-width: 800px;
            background: #000;
            color: var(--accent-gold);
            border: 2px solid var(--accent-gold);
        }

        .size-guide-modal .modal-header {
            background: #000;
            border-bottom: 2px solid var(--accent-gold);
        }

        .size-guide-modal .modal-title {
            color: var(--accent-gold);
            font-size: var(--text-2xl);
            font-weight: 800;
        }

        .size-guide-modal .modal-body {
            text-align: center;
        }

        .size-guide-modal .jersey-icon {
            font-size: 4rem;
            margin-bottom: var(--space-6);
            color: var(--accent-gold);
        }

        .size-guide-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--space-6);
            color: var(--accent-gold);
        }

        .size-guide-table th,
        .size-guide-table td {
            padding: var(--space-3);
            text-align: center;
            border: 1px solid var(--accent-gold);
        }

        .size-guide-table th {
            background: rgba(212, 175, 55, 0.2);
            font-weight: 700;
        }

        .size-guide-note {
            margin-top: var(--space-6);
            font-style: italic;
            color: var(--accent-gold);
            font-size: var(--text-sm);
        }

        /* Wishlist Modal */
        .wishlist-modal .modal-content {
            max-width: 900px;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid var(--accent-neon);
        }

        .wishlist-modal .modal-header {
            background: rgba(15, 23, 42, 0.9);
            border-bottom: 1px solid var(--accent-neon);
        }

        .wishlist-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: var(--space-6);
        }

        .wishlist-item {
            background: rgba(30, 41, 59, 0.8);
            border-radius: var(--radius-lg);
            overflow: hidden;
            transition: all var(--transition-fast);
            border: 1px solid var(--border-color);
        }

        .wishlist-item:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent-neon);
        }

        .wishlist-image {
            padding: var(--space-6);
            background: rgba(0, 0, 0, 0.3);
            text-align: center;
            font-size: 3rem;
        }

        .wishlist-info {
            padding: var(--space-4);
        }

        .wishlist-date {
            font-size: var(--text-xs);
            color: var(--text-muted);
            margin-top: var(--space-2);
        }

        .wishlist-actions {
            display: flex;
            gap: var(--space-2);
            margin-top: var(--space-4);
        }

        .empty-wishlist {
            text-align: center;
            padding: var(--space-12);
            color: var(--text-muted);
        }

        .empty-wishlist i {
            font-size: 4rem;
            margin-bottom: var(--space-4);
            opacity: 0.5;
        }

        /* Cart Icon in Nav */
        .cart-icon-container {
            position: relative;
        }

        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--accent-blue);
            color: var(--text-inverse);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-xs);
            font-weight: 700;
            transition: transform var(--transition-fast);
            transform: scale(0);
        }

        .cart-badge.show {
            transform: scale(1);
        }

        /* Cart & Order Modal Items */
        .cart-item {
            display: flex;
            gap: var(--space-4);
            padding: var(--space-4) 0;
            border-bottom: 1px solid var(--border-color);
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-image {
            font-size: 2.5rem;
            width: 60px;
            text-align: center;
            flex-shrink: 0;
        }

        .cart-item-details {
            flex: 1;
        }

        .cart-item-customization {
            font-size: var(--text-sm);
            color: var(--text-muted);
            margin-top: var(--space-1);
        }

        /* Quantity Selector in Cart */
        .quantity-selector {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-top: var(--space-3);
        }

        .quantity-btn {
            width: 28px;
            height: 28px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border-radius: 50%;
            cursor: pointer;
            font-weight: 600;
            transition: all var(--transition-fast);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .quantity-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .quantity-value {
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        /* Patch Selection */
        .patches-section {
            margin-top: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .patches-title {
            font-weight: 700;
            margin-bottom: var(--space-4);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .patches-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: var(--space-3);
        }

        .patch-option {
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--space-3);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .patch-option:hover {
            border-color: var(--accent-neon);
            transform: translateY(-2px);
        }

        .patch-option.selected {
            background: var(--accent-neon);
            border-color: var(--accent-neon);
            color: var(--text-primary);
        }

        .patch-icon {
            font-size: var(--text-2xl);
            margin-bottom: var(--space-2);
        }

        .patch-name {
            font-size: var(--text-xs);
            font-weight: 600;
        }

        .patch-price {
            font-size: var(--text-xs);
            color: var(--text-muted);
            margin-top: var(--space-1);
        }

        /* Pagination Controls */
        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: var(--space-8);
            gap: var(--space-2);
        }

        .pagination-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .pagination-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .pagination-btn.active {
            background: var(--accent-neon);
            color: var(--text-primary);
            border-color: var(--accent-neon);
        }

        .pagination-ellipsis {
            color: var(--text-muted);
            padding: 0 var(--space-2);
        }

        .per-page-selector {
            margin-left: var(--space-4);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        /* Filter Sidebar */
        .filter-sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 300px;
            height: 100%;
            background: var(--bg-primary);
            z-index: 3000;
            transform: translateX(-100%);
            transition: transform var(--transition-normal);
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
        }

        .filter-sidebar.show {
            transform: translateX(0);
        }

        .filter-header {
            padding: var(--space-4) var(--space-6);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-body {
            padding: var(--space-6);
            flex: 1;
            overflow-y: auto;
        }

        .filter-group {
            margin-bottom: var(--space-6);
        }

        .filter-group h4 {
            margin-bottom: var(--space-4);
        }

        .filter-group label {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-3);
            cursor: pointer;
        }

        .filter-footer {
            padding: var(--space-4) var(--space-6);
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: var(--space-4);
        }

        .filter-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2999;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-normal), visibility var(--transition-normal);
        }

        .filter-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        #priceValue {
            text-align: center;
            margin-top: var(--space-2);
            font-weight: 600;
        }

        /* Recently Viewed Section */
        .recently-viewed-section {
            padding: var(--space-8) 0;
            background: var(--bg-primary);
            border-top: 1px solid var(--border-color);
            margin-top: var(--space-12);
        }

        .section-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--space-6);
        }

        .section-title {
            font-size: var(--text-2xl);
            font-weight: 700;
            margin-bottom: var(--space-6);
            text-align: center;
        }

        .recently-viewed-grid {
            display: flex;
            gap: var(--space-6);
            overflow-x: auto;
            padding-bottom: var(--space-4);
            /* For scrollbar */
            -ms-overflow-style: none;
            /* IE and Edge */
            scrollbar-width: none;
            /* Firefox */
        }

        .recently-viewed-grid::-webkit-scrollbar {
            display: none;
            /* Chrome, Safari, Opera */
        }

        .recently-viewed-grid .product-card {
            flex: 0 0 250px;
            /* Fixed width for horizontal scroll */
        }

        /* Footer */
        .footer {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: var(--space-12) 0 var(--space-6);
            margin-top: var(--space-16);
        }

        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--space-6);
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-8);
        }

        .footer-section h3 {
            font-size: var(--text-xl);
            font-weight: 700;
            margin-bottom: var(--space-4);
            color: var(--text-primary);
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: var(--space-2);
        }

        .footer-links a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: all var(--transition-fast);
        }

        .footer-links a:hover {
            color: var(--accent-neon);
        }

        .social-links {
            display: flex;
            gap: var(--space-3);
            margin-top: var(--space-4);
        }

        .social-link {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: all var(--transition-fast);
        }

        .social-link:hover {
            background: var(--accent-neon);
            color: var(--text-primary);
            transform: translateY(-4px);
        }

        .footer-contact p {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-3);
            color: var(--text-secondary);
        }

        .footer-contact i {
            color: var(--accent-neon);
        }

        .footer-bottom {
            margin-top: var(--space-8);
            padding-top: var(--space-6);
            border-top: 1px solid var(--border-color);
            text-align: center;
            color: var(--text-muted);
            font-size: var(--text-sm);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .nav {
                padding: var(--space-3) var(--space-4);
            }

            .logo {
                font-size: var(--text-xl);
            }

            .nav-actions {
                gap: var(--space-2);
            }

            .btn {
                padding: var(--space-2) var(--space-3);
                font-size: var(--text-xs);
            }

            .search-title {
                font-size: var(--text-2xl);
            }

            .search-section {
                padding: var(--space-6) var(--space-4);
            }

            .chatbot-window {
                width: 300px;
                height: 400px;
            }

            .chatbot-container {
                bottom: var(--space-4);
                right: var(--space-4);
            }

            .dropdown-menu {
                min-width: 200px;
            }

            .modal-body {
                display: block !important;
            }

            .modal-body>div {
                grid-template-columns: 1fr !important;
                gap: var(--space-4) !important;
            }

            .patches-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .footer-grid {
                grid-template-columns: 1fr;
                gap: var(--space-6);
            }
        }

        @media (max-width: 480px) {
            .modal-content {
                margin: var(--space-2);
                max-height: 95vh;
            }

            .modal-header,
            .modal-body {
                padding: var(--space-4);
            }

            .chatbot-window {
                width: 280px;
                height: 350px;
            }

            .size-guide-table {
                font-size: var(--text-xs);
            }

            .pagination-controls {
                flex-wrap: wrap;
                justify-content: center;
            }
        }

        /* Animation Classes */
        .animate-fade-in-up {
            animation: fadeInUp 0.6s ease forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Toast Notification */
        .toast-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--accent-neon);
            color: var(--text-primary);
            padding: var(--space-4) var(--space-6);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-elevated);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            z-index: 2000;
            transform: translateX(100%);
            transition: transform var(--transition-normal);
            font-weight: 600;
            max-width: 300px;
        }

        .toast-notification.show {
            transform: translateX(0);
        }

        .toast-notification i {
            font-size: var(--text-lg);
        }
    </style>
</head>

<body class="dark">
    <!-- Header -->
    <header class="header">
        <nav class="nav">
            <div class="logo">GoKit.ME</div>

            <div class="nav-actions">
                <button class="btn btn-ghost" id="darkModeToggle">
                    <i class="fas fa-sun"></i>
                </button>

                <div class="account-dropdown">
                    <button class="btn btn-ghost" id="accountBtn">
                        <i class="fas fa-user"></i>
                        <span>Account</span>
                    </button>

                    <div class="dropdown-menu" id="accountDropdown">
                        <div class="dropdown-header">
                            <h4>My Account</h4>
                            <p style="color: var(--text-muted); font-size: var(--text-sm);">Manage your preferences</p>
                        </div>

                        <div id="discountCodesList">
                            <p style="color: var(--text-muted); font-size: var(--text-sm); padding: var(--space-4);">No
                                discount codes available</p>
                        </div>

                        <a href="wishlist.html" class="dropdown-item" id="viewWishlistBtn">
                            <i class="fas fa-heart"></i>
                            <span>Wishlist</span>
                        </a>
                        <a href="#" class="dropdown-item" id="viewOrdersBtn">
                            <i class="fas fa-shopping-bag"></i>
                            <span>Orders</span>
                        </a>
                        <div id="logoutContainer"></div>
                    </div>
                </div>

                <div class="cart-icon-container">

                    <button class="btn btn-ghost" id="cartBtn" aria-label="View shopping cart">
                        <i class="fas fa-shopping-cart"></i>
                    </button>
                    <span class="cart-badge" id="cartBadge">0</span>
                </div>

                <a href="football.html" class="btn btn-primary" id="goToLeagues">
                    <i class="fas fa-tshirt"></i>
                    <span>Browse</span>
                </a>
            </div>
        </nav>
    </header>

    <!-- Page Actions: Go to Leagues / Back to Home -->
    <div class="page-actions-container">
        <a href="#leagues" class="page-action-btn" id="scrollToLeaguesBtn">
            <i class="fas fa-arrow-left"></i>
            <span>Go to Leagues</span>
        </a>
        <a href="index.html" class="page-action-btn">
            <span>Back to Home</span>
            <i class="fas fa-arrow-right"></i>
        </a>
    </div>
    <!-- Search Section -->
    <section class="search-section">
        <div class="search-container">
            <h1 class="search-title">Find Your Perfect Jersey</h1>
            <p style="color: var(--text-muted); margin-bottom: var(--space-6);">
                Premium football jerseys with professional customization
            </p>

            <div class="search-input-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" id="searchInput"
                    placeholder="Search for teams, leagues, or players...">
                <div class="search-results-dropdown" id="searchResultsDropdown"></div>
            </div>
        </div>
    </section>

    <!-- Size Guide Button -->
    <div class="size-guide-container">
        <button class="size-guide-btn" id="sizeGuideBtn">
            <i class="fas fa-ruler"></i>
            <span>Size Guide</span>
        </button>
    </div>

    <!-- Products Section -->
    <section class="products-section" id="leagues">
        <div class="product-toolbar">
            <div class="toolbar-left">
                <button class="btn btn-ghost" id="filterBtn">
                    <i class="fas fa-filter"></i> Filter
                </button>
                <div class="sort-selector">
                    <span>Sort by:</span>
                    <div class="select-wrapper">
                        <select id="sortSelect">
                            <option value="default">Default</option>
                            <option value="price-asc">Price: Low to High</option>
                            <option value="price-desc">Price: High to Low</option>
                            <option value="name-asc">Name: A to Z</option>
                            <option value="name-desc">Name: Z to A</option>
                        </select>
                        <i class="fas fa-chevron-down select-arrow"></i>
                    </div>
                </div>
            </div>
            <div class="toolbar-right">
                <div class="per-page-selector">
                    <span>Show:</span>
                    <div class="select-wrapper">
                        <select id="perPageSelect">
                            <option value="12">12</option>
                            <option value="24">24</option>
                            <option value="36">36</option>
                            <option value="48">48</option>
                        </select>
                        <i class="fas fa-chevron-down select-arrow"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="products-grid" id="productGrid">
            <!-- Products will be loaded here by JavaScript -->
        </div>

        <!-- Pagination Controls -->
        <div class="pagination-controls">
            <button class="pagination-btn" id="prevPage">
                <i class="fas fa-chevron-left"></i>
            </button>

            <div id="paginationNumbers">
                <!-- Page numbers will be generated here -->
            </div>

            <button class="pagination-btn" id="nextPage">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </section>

    <!-- Filter Sidebar -->
    <div class="filter-sidebar" id="filterSidebar">
        <div class="filter-header">
            <h3>Filters</h3>
            <button class="modal-close" id="closeFilterBtn"><i class="fas fa-times"></i></button>
        </div>
        <div class="filter-body">
            <div class="filter-group">
                <h4>League</h4>
                <div id="leagueFilters">
                    <!-- League checkboxes will be generated here -->
                </div>
            </div>
            <div class="filter-group">
                <h4>Price Range</h4>
                <input type="range" id="priceRange" min="70" max="85" value="85" style="width: 100%;">
                <div id="priceValue">Up to 85 AED</div>
            </div>
            <button class="btn btn-ghost" id="clearFiltersBtn" style="width: 100%;">Clear All Filters</button>
        </div>
    </div>
    <div class="filter-overlay" id="filterOverlay"></div>

    <!-- Scroll to Top Button -->
    <button class="scroll-to-top-btn" id="scrollToTopBtn" title="Go to top">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Quick View Modal -->
    <div class="modal" id="quickViewModal">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h2 id="quickViewTitle">Jersey Customization</h2>
                    <p style="color: var(--text-muted);" id="quickViewTeam">Team Name</p>
                </div>
                <button class="modal-close" id="quickViewClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-8); align-items: start;">
                    <div>
                        <div id="quickViewImage"
                            style="text-align: center; padding: var(--space-8); background: var(--bg-secondary); border-radius: var(--radius-lg); margin-bottom: var(--space-6);">
                            <!-- Jersey image will be inserted here -->
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="playerName">Player Name (Optional)</label>
                            <input type="text" id="playerName" class="form-input" placeholder="Enter player name"
                                maxlength="20">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="playerNumber">Jersey Number (Optional)</label>
                            <input type="number" id="playerNumber" class="form-input" placeholder="0-99" min="0"
                                max="99">
                        </div>

                        <!-- Patches Section -->
                        <div class="patches-section">
                            <h3 class="patches-title">
                                <i class="fas fa-tags"></i>
                                Patches & Badges (+5 AED each)
                            </h3>
                            <div class="patches-grid">
                                <div class="patch-option" data-patch="champions" data-price="5">
                                    <div class="patch-icon">🏆</div>
                                    <div class="patch-name">Champions League</div>
                                    <div class="patch-price">+5 AED</div>
                                </div>
                                <div class="patch-option" data-patch="champions-stars" data-price="5">
                                    <div class="patch-icon">🌟</div>
                                    <div class="patch-name">UCL Stars</div>
                                    <div class="patch-price">+5 AED</div>
                                </div>
                                <div class="patch-option" data-patch="europa" data-price="5">
                                    <div class="patch-icon">⭐</div>
                                    <div class="patch-name">Europa League</div>
                                    <div class="patch-price">+5 AED</div>
                                </div>
                                <div class="patch-option" data-patch="cwc" data-price="5">
                                    <div class="patch-icon">🌍</div>
                                    <div class="patch-name">Club World Cup</div>
                                    <div class="patch-price">+5 AED</div>
                                </div>
                                <div class="patch-option" data-patch="respect" data-price="5">
                                    <div class="patch-icon">✊</div>
                                    <div class="patch-name">Respect Patch</div>
                                    <div class="patch-price">+5 AED</div>
                                </div>
                                <div class="patch-option" data-patch="foundation" data-price="5">
                                    <div class="patch-icon">🤝</div>
                                    <div class="patch-name">Foundation</div>
                                    <div class="patch-price">+5 AED</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="price-summary"
                            style="background: var(--bg-secondary); padding: var(--space-4); border-radius: var(--radius-lg); margin-bottom: var(--space-6);">
                            <h4 style="margin-bottom: var(--space-4);">Price Summary</h4>
                            <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-2);">
                                <span>Base Jersey</span>
                                <span id="basePrice">75 AED</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-2); display: none;"
                                id="nameNumberLine">
                                <span>Name & Number</span>
                                <span>15 AED</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-2); display: none;"
                                id="patchesLine">
                                <span>Patches (<span id="patchCount">0</span>)</span>
                                <span id="patchesPrice">0 AED</span>
                            </div>
                            <div
                                style="display: flex; justify-content: space-between; margin-bottom: var(--space-4); font-weight: 700; font-size: var(--text-lg); color: var(--accent-neon);">
                                <span>Total Price</span>
                                <span id="totalPrice">75 AED</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="customerNote">Special Requests (Optional)</label>
                            <textarea id="customerNote" class="form-input" rows="4"
                                placeholder="Any special requests or notes for your order..."></textarea>
                        </div>

                        <button class="btn btn-primary" id="addToCartBtn"
                            style="width: 100%; justify-content: center; padding: var(--space-4);">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Add to Cart</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Welcome Modal -->
    <div class="modal" id="welcomeModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <div>
                    <h2>Welcome to GoKit.ME! 🎉</h2>
                    <p style="color: var(--text-muted);">Get 10% off your first 3 orders</p>
                </div>
                <button class="modal-close" id="welcomeClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body">
                <form id="welcomeForm">
                    <div class="form-group">
                        <label class="form-label" for="welcomeName">Your Name</label>
                        <input type="text" id="welcomeName" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="welcomeEmail">Email Address</label>
                        <input type="email" id="welcomeEmail" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="welcomePhone">Phone Number</label>
                        <input type="tel" id="welcomePhone" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="jerseyRequest">Looking for any specific jersey?</label>
                        <input type="text" id="jerseyRequest" class="form-input"
                            placeholder="e.g., Real Madrid, Messi jersey...">
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">
                        <i class="fas fa-gift"></i>
                        <span>Get My Discount Code</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Size Guide Modal -->
    <div class="modal size-guide-modal" id="sizeGuideModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">GoKit.ME Player Version Size Chart</h2>
                <button class="modal-close" id="sizeGuideClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body">
                <div class="jersey-icon">
                    <i class="fas fa-tshirt"></i>
                </div>

                <table class="size-guide-table">
                    <thead>
                        <tr>
                            <th>Size (cm)</th>
                            <th>Length (cm)</th>
                            <th>Shoulder Width (cm)</th>
                            <th>Sleeve Length (cm)</th>
                            <th>Cuff Width (cm)</th>
                            <th>Height Range (cm)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>S</td>
                            <td>71</td>
                            <td>46</td>
                            <td>41.5</td>
                            <td>16.5</td>
                            <td>160-165</td>
                        </tr>
                        <tr>
                            <td>M</td>
                            <td>73</td>
                            <td>48</td>
                            <td>43</td>
                            <td>17</td>
                            <td>165-170</td>
                        </tr>
                        <tr>
                            <td>L</td>
                            <td>75</td>
                            <td>50</td>
                            <td>44.5</td>
                            <td>17.5</td>
                            <td>170-175</td>
                        </tr>
                        <tr>
                            <td>XL</td>
                            <td>77</td>
                            <td>52</td>
                            <td>46</td>
                            <td>18</td>
                            <td>175-180</td>
                        </tr>
                        <tr>
                            <td>2XL</td>
                            <td>79</td>
                            <td>54</td>
                            <td>47.5</td>
                            <td>18.5</td>
                            <td>180-185</td>
                        </tr>
                    </tbody>
                </table>

                <p class="size-guide-note">This is the official GoKit ME player version sizing guide.</p>
            </div>
        </div>
    </div>

    <!-- Wishlist Modal -->
    <div class="modal wishlist-modal" id="wishlistModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">My Wishlist</h2>
                <button class="modal-close" id="wishlistClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body">
                <div class="wishlist-items" id="wishlistItems">
                    <!-- Wishlist items will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div class="modal" id="cartModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Your Shopping Cart</h2>
                <button class="modal-close" id="cartClose" aria-label="Close dialog">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="cartItemsContainer">
                <!-- Cart items will be loaded here -->
            </div>
            <div class="modal-footer"
                style="padding: var(--space-6); border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <span style="font-weight: 700; font-size: var(--text-lg);">Total:</span>
                    <span id="cartTotal"
                        style="font-weight: 700; font-size: var(--text-lg); color: var(--accent-neon);">0 AED</span>
                </div>
                <button class="btn btn-primary">
                    <i class="fas fa-credit-card"></i>
                    <span>Proceed to Checkout</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div class="modal" id="cartModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Your Shopping Cart</h2>
                <button class="modal-close" id="cartClose" aria-label="Close dialog">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="cartItemsContainer">
                <!-- Cart items will be loaded here -->
            </div>
            <div class="modal-footer"
                style="padding: var(--space-6); border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <span style="font-weight: 700; font-size: var(--text-lg);">Total:</span>
                    <span id="cartTotal"
                        style="font-weight: 700; font-size: var(--text-lg); color: var(--accent-neon);">0 AED</span>
                </div>
                <a href="cart.html" class="btn btn-primary">
                    <i class="fas fa-credit-card"></i>
                    <span>Proceed to Checkout</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Orders Modal -->
    <div class="modal" id="ordersModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">My Orders</h2>
                <button class="modal-close" id="ordersClose" aria-label="Close dialog">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="orderItemsContainer">
                <!-- Order items will be loaded here -->
            </div>
        </div>
    </div>


    <!-- Chatbot -->
    <div class="chatbot-container">
        <div class="chatbot-window" id="chatbotWindow">
            <div class="chatbot-header">
                <div class="chatbot-title">GoKit Support</div>
                <button class="modal-close" id="chatbotClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="chatbot-messages" id="chatbotMessages">
                <div class="message">
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        Hi! I'm GoKit's virtual assistant. Ask me about sizing, shipping, or finding your favorite
                        team's jersey!
                    </div>
                </div>
            </div>

            <div class="chatbot-input">
                <input type="text" id="chatbotInput" placeholder="Type your message...">
                <button class="chatbot-send" id="chatbotSend" aria-label="Send message">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>

        <div class="chatbot-launcher">
            <button class="chatbot-toggle" id="chatbotToggle" aria-label="Toggle chatbot">
                <i class="fas fa-futbol"></i>
            </button>
        </div>
    </div>

    <!-- Recently Viewed Section -->
    <section class="recently-viewed-section">
        <div class="section-container">
            <h2 class="section-title">Recently Viewed</h2>
            <div class="recently-viewed-grid" id="recentlyViewedGrid">
                <!-- Recently viewed items will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3>GoKit.ME</h3>
                    <p style="color: var(--text-secondary); margin-bottom: var(--space-4);">
                        Premium football jerseys with professional customization. We deliver quality products with
                        exceptional service.
                    </p>
                    <div class="social-links">
                        <a href="#" class="social-link">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="social-link">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="social-link">
                            <i class="fab fa-facebook"></i>
                        </a>
                        <a href="#" class="social-link">
                            <i class="fab fa-tiktok"></i>
                        </a>
                        <a href="#" class="social-link">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                    </div>
                </div>

                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="jerseys.html">All Jerseys</a></li>
                        <li><a href="premier-league.html">Premier League</a></li>
                        <li><a href="la-liga.html">La Liga</a></li>
                        <li><a href="serie-a.html">Serie A</a></li>
                        <li><a href="bundesliga.html">Bundesliga</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3>Customer Service</h3>
                    <ul class="footer-links">
                        <li><a href="size-guide.html">Size Guide</a></li>
                        <li><a href="shipping.html">Shipping Information</a></li>
                        <li><a href="returns.html">Returns & Exchanges</a></li>
                        <li><a href="faq.html">FAQ</a></li>
                        <li><a href="contact.html">Contact Us</a></li>
                    </ul>
                </div>

                <div class="footer-section footer-contact">
                    <h3>Contact Us</h3>
                    <p><i class="fas fa-phone"></i> +971 50 123 4567</p>
                    <p><i class="fas fa-envelope"></i> support@gokit.me</p>
                    <p><i class="fas fa-map-marker-alt"></i> Dubai, United Arab Emirates</p>
                    <p><i class="fas fa-clock"></i> Open 7 days a week, 10am - 10pm</p>
                </div>
            </div>

            <div class="footer-bottom">
                <p>© 2024 GoKit.ME. All rights reserved. | Premium Football Jerseys</p>
            </div>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <script>
        // Firebase Configuration
        try {
            const firebaseConfig = {
                apiKey: "AIzaSyAbMf3bPs97pkfXUKB_44rKoRWmvt9b0yM",
                authDomain: "gokit-x-courtdripdxb.firebaseapp.com",
                projectId: "gokit-x-courtdripdxb",
                storageBucket: "gokit-x-courtdripdxb.firebasestorage.app",
                messagingSenderId: "384570406205",
                appId: "1:384570406205:web:966041b461575405b74154"
            };

            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            const auth = firebase.auth();

            window.firebaseApp = firebase.app();
            window.db = db;
            window.auth = auth;

            console.log('Firebase initialized successfully');
        } catch (error) {
            console.log('Firebase initialization error:', error);
            window.firebaseApp = null;
            window.db = null;
            window.auth = null;
        }

        // Global Variables
        let currentUser = null;
        let wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let selectedPatches = new Set();

        // Centralized State
        const state = {
            theme: 'dark',
            currentPage: 1,
            itemsPerPage: 12,
            totalPages: 1,
            sortBy: 'default',
            activeFilters: {
                leagues: [],
                maxPrice: 85
            },
            // In a full refactor, products, wishlist, etc. would also be here
        };

        // Sample Products Data
        const products = [
            {
                id: 1,
                name: "Real Madrid Home Jersey 2024",
                team: "Real Madrid",
                league: "La Liga",
                price: 75,
                originalPrice: 95,
                discount: 21,
                image: "👑",
                badge: "Popular",
                colors: ["white", "gold"],
                hasUcl: true,
                uclStars: 14
            },
            {
                id: 2,
                name: "Barcelona Home Jersey 2024",
                team: "FC Barcelona",
                league: "La Liga",
                price: 75,
                originalPrice: 95,
                discount: 21,
                image: "🔵",
                badge: "New",
                colors: ["blue", "red"],
                hasUcl: true,
                uclStars: 5
            },
            {
                id: 3,
                name: "Manchester United Home Jersey",
                team: "Manchester United",
                league: "Premier League",
                price: 80,
                originalPrice: 100,
                discount: 20,
                image: "👹",
                badge: "Hot",
                colors: ["red", "black"],
                hasUcl: true,
                uclStars: 3
            },
            {
                id: 4,
                name: "Liverpool Home Jersey 2024",
                team: "Liverpool FC",
                league: "Premier League",
                price: 80,
                originalPrice: 100,
                discount: 20,
                image: "🔴",
                badge: "Popular",
                colors: ["red", "white"],
                hasUcl: true,
                uclStars: 6
            },
            {
                id: 5,
                name: "Manchester City Home Jersey",
                team: "Manchester City",
                league: "Premier League",
                price: 80,
                originalPrice: 100,
                discount: 20,
                image: "💙",
                badge: "New",
                colors: ["sky blue", "white"],
                hasUcl: true,
                uclStars: 1
            },
            {
                id: 6,
                name: "Chelsea Home Jersey 2024",
                team: "Chelsea FC",
                league: "Premier League",
                price: 80,
                originalPrice: 100,
                discount: 20,
                image: "🦁",
                badge: "Hot",
                colors: ["blue", "white"],
                hasUcl: true,
                uclStars: 2
            },
            {
                id: 7,
                name: "Arsenal Home Jersey 2024",
                team: "Arsenal FC",
                league: "Premier League",
                price: 80,
                originalPrice: 100,
                discount: 20,
                image: "🔫",
                badge: "Popular",
                colors: ["red", "white"],
                hasUcl: false
            },
            {
                id: 8,
                name: "Tottenham Home Jersey 2024",
                team: "Tottenham",
                league: "Premier League",
                price: 80,
                originalPrice: 100,
                discount: 20,
                image: "⚪",
                badge: "New",
                colors: ["white", "navy"],
                hasUcl: false
            },
            {
                id: 9,
                name: "PSG Home Jersey 2024",
                team: "Paris Saint-Germain",
                league: "Ligue 1",
                price: 85,
                originalPrice: 105,
                discount: 19,
                image: "🗼",
                badge: "Premium",
                colors: ["navy", "red"],
                hasUcl: true,
                uclStars: 0
            },
            {
                id: 10,
                name: "Bayern Munich Home Jersey",
                team: "Bayern Munich",
                league: "Bundesliga",
                price: 85,
                originalPrice: 105,
                discount: 19,
                image: "🏔️",
                badge: "Popular",
                colors: ["red", "white"],
                hasUcl: true,
                uclStars: 6
            },
            {
                id: 11,
                name: "Juventus Home Jersey 2024",
                team: "Juventus",
                league: "Serie A",
                price: 75,
                originalPrice: 95,
                discount: 21,
                image: "⚫",
                badge: "Classic",
                colors: ["black", "white"],
                hasUcl: true,
                uclStars: 2
            },
            {
                id: 12,
                name: "AC Milan Home Jersey 2024",
                team: "AC Milan",
                league: "Serie A", price: 75,
                originalPrice: 95,
                discount: 21,
                image: "🔴",
                badge: "Hot",
                colors: ["red", "black"],
                hasUcl: true,
                uclStars: 7
            },
            {
                id: 13,
                name: "Inter Milan Home Jersey 2024",
                team: "Inter Milan",
                league: "Serie A",
                price: 75,
                originalPrice: 95,
                discount: 21,
                image: "🔵",
                badge: "New",
                colors: ["blue", "black"],
                hasUcl: true,
                uclStars: 3
            },
            {
                id: 14,
                name: "Napoli Home Jersey 2024",
                team: "Napoli",
                league: "Serie A",
                price: 75,
                originalPrice: 95,
                discount: 21,
                image: "🔵",
                badge: "Hot",
                colors: ["light blue", "white"],
                hasUcl: false
            },
            {
                id: 15,
                name: "Borussia Dortmund Home Jersey",
                team: "Borussia Dortmund",
                league: "Bundesliga",
                price: 80,
                originalPrice: 100,
                discount: 20,
                image: "🟡",
                badge: "Popular",
                colors: ["yellow", "black"],
                hasUcl: true,
                uclStars: 1
            },
            {
                id: 16,
                name: "Atletico Madrid Home Jersey",
                team: "Atletico Madrid",
                league: "La Liga",
                price: 75,
                originalPrice: 95,
                discount: 21,
                image: "🔴",
                badge: "Classic",
                colors: ["red", "white"],
                hasUcl: false
            },
            {
                id: 17,
                name: "Ajax Home Jersey 2024",
                team: "Ajax",
                league: "Eredivisie",
                price: 70,
                originalPrice: 90,
                discount: 22,
                image: "⚪",
                badge: "Classic",
                colors: ["white", "red"],
                hasUcl: true,
                uclStars: 4
            },
            {
                id: 18,
                name: "Benfica Home Jersey 2024",
                team: "Benfica",
                league: "Primeira Liga",
                price: 70,
                originalPrice: 90,
                discount: 22,
                image: "🦅",
                badge: "New",
                colors: ["red", "white"],
                hasUcl: true,
                uclStars: 2
            },
            {
                id: 19,
                name: "Porto Home Jersey 2024",
                team: "FC Porto",
                league: "Primeira Liga",
                price: 70,
                originalPrice: 90,
                discount: 22,
                image: "🔵",
                badge: "Classic",
                colors: ["blue", "white"],
                hasUcl: true,
                uclStars: 2
            },
            {
                id: 20,
                name: "Celtic Home Jersey 2024",
                team: "Celtic",
                league: "Scottish Premiership",
                price: 70,
                originalPrice: 90,
                discount: 22,
                image: "🍀",
                badge: "Classic",
                colors: ["green", "white"],
                hasUcl: true,
                uclStars: 1
            },
            {
                id: 21,
                name: "Rangers Home Jersey 2024",
                team: "Rangers",
                league: "Scottish Premiership",
                price: 70,
                originalPrice: 90,
                discount: 22,
                image: "🔵",
                badge: "New",
                colors: ["blue", "white"],
                hasUcl: false
            },
            {
                id: 22,
                name: "Galatasaray Home Jersey 2024",
                team: "Galatasaray",
                league: "Süper Lig",
                price: 70,
                originalPrice: 90,
                discount: 22,
                image: "🦁",
                badge: "Hot",
                colors: ["yellow", "red"],
                hasUcl: false
            },
            {
                id: 23,
                name: "Fenerbahçe Home Jersey 2024",
                team: "Fenerbahçe",
                league: "Süper Lig",
                price: 70,
                originalPrice: 90,
                discount: 22,
                image: "🟡",
                badge: "New",
                colors: ["yellow", "blue"],
                hasUcl: false
            },
            {
                id: 24,
                name: "Boca Juniors Home Jersey 2024",
                team: "Boca Juniors",
                league: "Primera División",
                price: 75,
                originalPrice: 95,
                discount: 21,
                image: "🔵",
                badge: "Classic",
                colors: ["blue", "yellow"],
                hasUcl: false
            }
        ];

        // Size Chart Data
        const sizeChart = {
            S: {
                length: 71,
                shoulderWidth: 46,
                sleeveLength: 41.5,
                cuffWidth: 16.5,
                heightRange: "160-165"
            },
            M: {
                length: 73,
                shoulderWidth: 48,
                sleeveLength: 43,
                cuffWidth: 17,
                heightRange: "165-170"
            },
            L: {
                length: 75,
                shoulderWidth: 50,
                sleeveLength: 44.5,
                cuffWidth: 17.5,
                heightRange: "170-175"
            },
            XL: {
                length: 77,
                shoulderWidth: 52,
                sleeveLength: 46,
                cuffWidth: 18,
                heightRange: "175-180"
            },
            "2XL": {
                length: 79,
                shoulderWidth: 54,
                sleeveLength: 47.5,
                cuffWidth: 18.5,
                heightRange: "180-185"
            }
        };

        // DOM Elements
        const darkModeToggle = document.getElementById('darkModeToggle');
        const accountBtn = document.getElementById('accountBtn');
        const accountDropdown = document.getElementById('accountDropdown');
        const searchInput = document.getElementById('searchInput');
        const productGrid = document.getElementById('productGrid');
        const chatbotToggle = document.getElementById('chatbotToggle');
        const chatbotWindow = document.getElementById('chatbotWindow');
        const chatbotClose = document.getElementById('chatbotClose');
        const chatbotInput = document.getElementById('chatbotInput');
        const chatbotSend = document.getElementById('chatbotSend');
        const chatbotMessages = document.getElementById('chatbotMessages');
        const quickViewModal = document.getElementById('quickViewModal');
        const welcomeModal = document.getElementById('welcomeModal');
        const sizeGuideBtn = document.getElementById('sizeGuideBtn');
        const sizeGuideModal = document.getElementById('sizeGuideModal');
        const viewWishlistBtn = document.getElementById('viewWishlistBtn');
        const wishlistModal = document.getElementById('wishlistModal');
        const prevPageBtn = document.getElementById('prevPage');
        const cartBtn = document.getElementById('cartBtn');
        const cartModal = document.getElementById('cartModal');
        const nextPageBtn = document.getElementById('nextPage');
        const paginationNumbers = document.getElementById('paginationNumbers');
        const sortSelect = document.getElementById('sortSelect');
        const perPageSelect = document.getElementById('perPageSelect');
        const scrollToTopBtn = document.getElementById('scrollToTopBtn');
        const filterBtn = document.getElementById('filterBtn');
        const filterSidebar = document.getElementById('filterSidebar');
        const filterOverlay = document.getElementById('filterOverlay');
        const closeFilterBtn = document.getElementById('closeFilterBtn');
        const clearFiltersBtn = document.getElementById('clearFiltersBtn');
        const recentlyViewedGrid = document.getElementById('recentlyViewedGrid');

        // Initialize App
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize state first
            initializeState();
            setupPagination();
            setupEventListeners();
            populateLeagueFilters();
            render(); // Initial render based on state
            renderRecentlyViewed();

            // Show welcome modal for new users
            if (!localStorage.getItem('hasVisited')) {
                setTimeout(() => {
                    if (!document.querySelector('.modal.show')) {
                        showWelcomeModal();
                    }
                }, 1000);
            }
        });

        function initializeState() {
            // Set initial theme
            state.theme = localStorage.getItem('theme') || 'dark';

            // Set initial items per page
            const savedPerPage = localStorage.getItem('itemsPerPage');
            if (savedPerPage) {
                state.itemsPerPage = parseInt(savedPerPage);
                perPageSelect.value = savedPerPage;
            }

            state.totalPages = Math.ceil(products.length / state.itemsPerPage);
        }

        function render() {
            // This function updates the DOM based on the current state
            // In a full refactor, it would be the single point of DOM updates
            document.body.className = state.theme;
            updateThemeIcon(state.theme);
            loadProducts(); // This function already re-renders the product grid
            updatePaginationUI(); // This function re-renders pagination
        }

        function setupEventListeners() {
            // Dark Mode Toggle
            darkModeToggle.addEventListener('click', toggleDarkMode);

            // Account Dropdown
            accountBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                accountDropdown.classList.toggle('show');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!accountDropdown.contains(e.target) && !accountBtn.contains(e.target)) {
                    accountDropdown.classList.remove('show');
                }
            });

            // Search functionality
            searchInput.addEventListener('input', handleAutocompleteSearch);
            // The main grid search is debounced to avoid excessive re-rendering
            searchInput.addEventListener('input', debounce(handleGridSearch, 300));


            // Add event listener to the product grid for delegation
            productGrid.addEventListener('click', handleProductGridClick);

            // Chatbot functionality
            chatbotToggle.addEventListener('click', toggleChatbot);
            chatbotClose.addEventListener('click', closeChatbot);
            chatbotSend.addEventListener('click', sendMessage);
            chatbotInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // Modal close handlers
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', function () {
                    closeModal(this.closest('.modal').id);
                });
            });

            // Event delegation for autocomplete results
            const searchResultsDropdown = document.getElementById('searchResultsDropdown');
            searchResultsDropdown.addEventListener('click', (e) => {
                const item = e.target.closest('.search-result-item');
                if (item) {
                    e.preventDefault();
                    const productId = parseInt(item.dataset.productId);
                    openQuickView(productId);
                    searchResultsDropdown.style.display = 'none';
                    searchInput.value = ''; // Clear search input
                    handleGridSearch(); // Reset grid to show all products
                }
            });

            // Close modals when clicking outside
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModal(modal.id);
                    }
                });
            });

            // Close autocomplete when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.search-input-container')) {
                    document.getElementById('searchResultsDropdown').style.display = 'none';
                }
            });

            // Welcome form
            const welcomeForm = document.getElementById('welcomeForm');
            if (welcomeForm) {
                welcomeForm.addEventListener('submit', handleWelcomeForm);
            }

            // Price calculation
            const playerName = document.getElementById('playerName');
            const playerNumber = document.getElementById('playerNumber');
            if (playerName && playerNumber) {
                playerName.addEventListener('input', updatePrice);
                playerNumber.addEventListener('input', updatePrice);
            }

            // Add to cart
            const addToCartBtn = document.getElementById('addToCartBtn');
            if (addToCartBtn) {
                addToCartBtn.addEventListener('click', addToCart);
            }

            // Size Guide
            sizeGuideBtn.addEventListener('click', () => {
                showModal('sizeGuideModal');
            });

            // View Wishlist
            viewWishlistBtn.addEventListener('click', (e) => {
                e.preventDefault();
                showWishlistModal();
            });

            // View Orders
            const viewOrdersBtn = document.getElementById('viewOrdersBtn');
            if (viewOrdersBtn) {
                viewOrdersBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    showOrdersModal();
                });
            }

            // Page Action: Scroll to Leagues
            const scrollToLeaguesBtn = document.getElementById('scrollToLeaguesBtn');
            if (scrollToLeaguesBtn) {
                scrollToLeaguesBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.getElementById('leagues').scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            }
            // Patch selection
            document.querySelectorAll('.patch-option').forEach(patch => {
                patch.addEventListener('click', () => {
                    togglePatch(patch);
                });
            });

            // Cart Modal
            cartBtn.addEventListener('click', showCartModal);
            const cartModal = document.getElementById('cartModal');
            if (cartModal) {
                cartModal.addEventListener('click', handleCartActions);
            }

            // Pagination
            prevPageBtn.addEventListener('click', () => {
                if (state.currentPage > 1) {
                    state.currentPage--;
                    render();
                    window.scrollTo(0, 0);
                }
            });

            nextPageBtn.addEventListener('click', () => {
                if (state.currentPage < state.totalPages) {
                    state.currentPage++;
                    render();
                    window.scrollTo(0, 0);
                }
            });

            // Items per page
            perPageSelect.addEventListener('change', () => {
                state.itemsPerPage = parseInt(perPageSelect.value);
                localStorage.setItem('itemsPerPage', state.itemsPerPage);
                state.currentPage = 1;
                setupPagination();
                render();
            });

            // Sort select
            sortSelect.addEventListener('change', () => {
                state.sortBy = sortSelect.value;
                state.currentPage = 1;
                render();
            });

            // Scroll to top button
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    scrollToTopBtn.classList.add('show');
                } else {
                    scrollToTopBtn.classList.remove('show');
                }
            });
            scrollToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            // Filter sidebar
            filterBtn.addEventListener('click', () => filterSidebar.classList.add('show'));
            closeFilterBtn.addEventListener('click', () => filterSidebar.classList.remove('show'));
            filterOverlay.addEventListener('click', () => filterSidebar.classList.remove('show'));

            // Instant filtering
            const leagueFiltersContainer = document.getElementById('leagueFilters');
            const priceRangeSlider = document.getElementById('priceRange');

            leagueFiltersContainer.addEventListener('change', () => {
                updateActiveFilters();
                render();
            });
            priceRangeSlider.addEventListener('input', debounce(() => {
                updateActiveFilters();
                render();
            }, 200));
            clearFiltersBtn.addEventListener('click', () => {
                resetFilters();
            });
        }

        // Theme Functions
        function toggleDarkMode() {
            state.theme = state.theme === 'dark' ? 'light' : 'dark';
            localStorage.setItem('theme', state.theme);
            render();
        }

        function updateThemeIcon(theme) {
            const icon = darkModeToggle.querySelector('i');
            icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        // Pagination Functions
        function setupPagination() {
            state.totalPages = Math.ceil(products.length / state.itemsPerPage);
            updatePaginationUI();
        }

        function updatePaginationUI() {
            paginationNumbers.innerHTML = '';

            // Previous button state
            prevPageBtn.disabled = state.currentPage === 1;
            prevPageBtn.style.opacity = state.currentPage === 1 ? '0.5' : '1';

            // Next button state
            nextPageBtn.disabled = state.currentPage === state.totalPages;
            nextPageBtn.style.opacity = state.currentPage === state.totalPages ? '0.5' : '1';

            // Generate page numbers
            let startPage = Math.max(1, state.currentPage - 2);
            let endPage = Math.min(state.totalPages, state.currentPage + 2);

            // Always show first page
            if (startPage > 1) {
                addPageButton(1);
                if (startPage > 2) {
                    addEllipsis();
                }
            }

            // Add page numbers
            for (let i = startPage; i <= endPage; i++) {
                addPageButton(i);
            }

            // Always show last page
            if (endPage < state.totalPages) {
                if (endPage < state.totalPages - 1) {
                    addEllipsis();
                }
                addPageButton(state.totalPages);
            }
        }

        function addPageButton(pageNum) {
            const button = document.createElement('button');
            button.className = `pagination-btn ${pageNum === state.currentPage ? 'active' : ''}`;
            button.textContent = pageNum;
            button.addEventListener('click', () => {
                state.currentPage = pageNum;
                render();
                window.scrollTo(0, 0);
            });
            paginationNumbers.appendChild(button);
        }

        function addEllipsis() {
            const span = document.createElement('span');
            span.className = 'pagination-ellipsis';
            span.textContent = '...';
            paginationNumbers.appendChild(span);
        }

        // Product Functions
        function loadProducts() {
            const filteredAndSortedProducts = getFilteredAndSortedProducts();
            state.totalPages = Math.ceil(filteredAndSortedProducts.length / state.itemsPerPage);
            if (state.currentPage > state.totalPages) state.currentPage = 1;
            updatePaginationUI();

            showSkeletonLoader(state.itemsPerPage);

            setTimeout(() => { // Simulate loading delay
                productGrid.innerHTML = '';

                // Calculate start and end indices for current page
                const startIndex = (state.currentPage - 1) * state.itemsPerPage;
                const endIndex = Math.min(startIndex + state.itemsPerPage, filteredAndSortedProducts.length);

                // Get current page products
                const currentProducts = filteredAndSortedProducts.slice(startIndex, endIndex);

                if (currentProducts.length === 0) {
                    productGrid.innerHTML = `<div style="grid-column: 1 / -1; text-align: center; padding: var(--space-12);"><h3>No products match your criteria.</h3></div>`;
                    return;
                }

                currentProducts.forEach((product, index) => {
                    const productCard = createProductCard(product);
                    productCard.style.animationDelay = `${index * 0.1}s`;
                    productCard.classList.add('animate-fade-in-up');
                    productGrid.appendChild(productCard);
                });
            }, 300);
        }

        function getFilteredAndSortedProducts() {
            const searchQuery = searchInput.value.toLowerCase();
            let filteredProducts = products;

            // 1. Search filter
            if (searchQuery) {
                filteredProducts = filteredProducts.filter(product =>
                    product.name.toLowerCase().includes(searchQuery) ||
                    product.team.toLowerCase().includes(searchQuery) ||
                    product.league.toLowerCase().includes(searchQuery)
                );
            }

            // 2. Sidebar filters
            // League filter
            if (state.activeFilters.leagues.length > 0) {
                filteredProducts = filteredProducts.filter(product =>
                    state.activeFilters.leagues.includes(product.league)
                );
            }

            // Price filter
            filteredProducts = filteredProducts.filter(product => product.price <= state.activeFilters.maxPrice);

            // 3. Sorting
            const productsCopy = [...filteredProducts]; // Create a copy to avoid mutating the filtered array
            switch (state.sortBy) {
                case 'price-asc':
                    return productsCopy.sort((a, b) => a.price - b.price);
                case 'price-desc':
                    return productsCopy.sort((a, b) => b.price - a.price);
                case 'name-asc':
                    return productsCopy.sort((a, b) => a.name.localeCompare(b.name));
                case 'name-desc':
                    return productsCopy.sort((a, b) => b.name.localeCompare(a.name));
                case 'default':
                default:
                    return productsCopy.sort((a, b) => a.id - b.id); // Sort by original order
            }
        }

        function populateLeagueFilters() {
            const leagueFiltersContainer = document.getElementById('leagueFilters');
            const leagues = [...new Set(products.map(p => p.league))].sort(); // Get unique, sorted leagues
            leagueFiltersContainer.innerHTML = leagues.map(league => `
                <label>
                    <input type="checkbox" value="${league}" name="league">
                    <span>${league}</span>
                </label>
            `).join('');

            document.getElementById('priceRange').addEventListener('input', (e) => {
                document.getElementById('priceValue').textContent = `Up to ${e.target.value} AED`;
            });
        }

        function updateActiveFilters() {
            const selectedLeagues = [];
            document.querySelectorAll('#leagueFilters input:checked').forEach(checkbox => {
                selectedLeagues.push(checkbox.value);
            });
            state.activeFilters.leagues = selectedLeagues;
            state.activeFilters.maxPrice = parseInt(document.getElementById('priceRange').value);
        }

        function resetFilters() {
            document.querySelectorAll('#leagueFilters input[type="checkbox"]').forEach(checkbox => checkbox.checked = false);
            const priceRange = document.getElementById('priceRange');
            priceRange.value = priceRange.max;
            document.getElementById('priceValue').textContent = `Up to ${priceRange.max} AED`;
            updateActiveFilters();
            render();
        }

        function showSkeletonLoader(count) {
            productGrid.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const skeletonCard = document.createElement('div');
                skeletonCard.className = 'skeleton-card';
                skeletonCard.innerHTML = `
                    <div class="skeleton-image"></div>
                    <div class="skeleton-info">
                        <div class="skeleton-line short"></div>
                        <div class="skeleton-line long"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-button"></div>
                    </div>
                `;
                productGrid.appendChild(skeletonCard);
            }
        }

        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.dataset.productId = product.id;
            card.innerHTML = `
                <div class="product-image-container">
                    <div class="product-badge">${product.badge}</div>
                    <div class="product-actions">
                        <button class="action-btn wishlist-btn ${wishlist.includes(product.id) ? 'active' : ''}" 
                                data-action="wishlist">
                            <i class="fas fa-heart"></i>
                        </button>
                        <button class="action-btn" data-action="quick-view">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="product-image">${product.image}</div>
                </div>
                
                <div class="product-info">
                    <div class="product-team">${product.team}</div>
                    <h3 class="product-name">${product.name}</h3>
                    
                    <div class="product-pricing">
                        <span class="product-price">${product.price} AED</span>
                        <span class="product-original-price">${product.originalPrice} AED</span>
                        <span class="product-discount">-${product.discount}%</span>
                    </div>
                    
                    <button class="btn btn-primary" data-action="quick-view" style="width: 100%; justify-content: center;">
                        <i class="fas fa-tshirt"></i>
                        <span>Customize</span>
                    </button>
                </div>
            `;
            return card;
        }

        function handleAutocompleteSearch(e) {
            const query = e.target.value.toLowerCase();
            const dropdown = document.getElementById('searchResultsDropdown');

            if (query.length < 2) {
                dropdown.style.display = 'none';
                return;
            }

            const results = products.filter(p =>
                p.name.toLowerCase().includes(query) ||
                p.team.toLowerCase().includes(query)
            ).slice(0, 5); // Limit to 5 results

            if (results.length === 0) {
                dropdown.style.display = 'none';
                return;
            }

            dropdown.innerHTML = results.map(product => `
                <a href="#" class="search-result-item" data-product-id="${product.id}">
                    <div class="search-result-image">${product.image}</div>
                    <div class="search-result-info">
                        <div class="product-name" style="font-size: var(--text-base); margin-bottom: 0;">${product.name}</div>
                        <div class="product-team" style="font-size: var(--text-sm); margin-bottom: 0;">${product.team}</div>
                    </div>
                </a>
            `).join('');

            dropdown.style.display = 'block';
        }


        function handleGridSearch() {
            // This function now just triggers a re-render, which will use the search input value
            render();
        }

        // Wishlist Functions
        function toggleWishlist(productId, event) {
            if (event) {
                event.stopPropagation();
            }

            const index = wishlist.indexOf(productId);
            const now = new Date();

            if (index > -1) {
                wishlist.splice(index, 1);
                showToast('Removed from wishlist', 'fas fa-heart-broken');
            } else {
                wishlist.push(productId);
                // Save timestamp with product ID
                localStorage.setItem(`wishlist_time_${productId}`, now.toISOString());
                showToast('Added to wishlist', 'fas fa-heart');
            }

            localStorage.setItem('wishlist', JSON.stringify(wishlist));

            // Update wishlist button
            const wishlistBtns = document.querySelectorAll(`.product-card[data-product-id="${productId}"] .wishlist-btn`);
            wishlistBtns.forEach(btn => {
                btn.classList.toggle('active');
            });
        }

        function showWishlistModal() {
            const wishlistItems = document.getElementById('wishlistItems');
            wishlistItems.innerHTML = '';

            if (wishlist.length === 0) {
                wishlistItems.innerHTML = `
                    <div class="empty-wishlist">
                        <i class="fas fa-heart-broken"></i>
                        <h3>Your wishlist is empty</h3>
                        <p>Add items to your wishlist to keep track of jerseys you love</p>
                    </div>
                `;
            } else {
                wishlist.forEach(productId => {
                    const product = products.find(p => p.id === productId);
                    if (!product) return;

                    const addedDate = localStorage.getItem(`wishlist_time_${productId}`);
                    const formattedDate = addedDate ? new Date(addedDate).toLocaleString() : 'Unknown date';

                    const wishlistItem = document.createElement('div');
                    wishlistItem.className = 'wishlist-item';
                    wishlistItem.innerHTML = `
                        <div class="wishlist-image">${product.image}</div>
                        <div class="wishlist-info">
                            <div class="product-team">${product.team}</div>
                            <h3 class="product-name">${product.name}</h3>
                            <div class="product-price">${product.price} AED</div>
                            <div class="wishlist-date">Added on: ${formattedDate}</div>
                            <div class="wishlist-actions">
                                <button class="btn btn-primary" onclick="openQuickView(${product.id}, event)">
                                    <i class="fas fa-tshirt"></i>
                                    <span>Customize</span>
                                </button>
                                <button class="btn btn-ghost" onclick="toggleWishlist(${product.id}, event)">
                                    <i class="fas fa-trash"></i>
                                    <span>Remove</span>
                                </button>
                            </div>
                        </div>
                    `;
                    wishlistItems.appendChild(wishlistItem);
                });
            }

            closeAccountDropdown();
            showModal('wishlistModal');
        }

        // Cart & Order Functions
        function updateCartIcon() {
            const cartBadge = document.getElementById('cartBadge');
            const cartItemCount = cart.length;
            cartBadge.textContent = cartItemCount;
            if (cartItemCount > 0) {
                cartBadge.classList.add('show');
            } else {
                cartBadge.classList.remove('show');
            }
        }

        function showOrdersModal() {
            const orderItemsContainer = document.getElementById('orderItemsContainer');
            orderItemsContainer.innerHTML = '';
            const orders = JSON.parse(localStorage.getItem('cart')) || []; // Using 'cart' as the order history

            if (orders.length === 0) {
                orderItemsContainer.innerHTML = `
                    <div class="empty-wishlist">
                        <i class="fas fa-receipt"></i>
                        <h3>You have no past orders</h3>
                        <p>Once you place an order, it will appear here.</p>
                    </div>
                `;
            } else {
                orders.forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'cart-item'; // Re-use cart item styles
                    itemEl.dataset.orderId = item.id;

                    let customizationDetails = '';
                    if (item.playerName || item.playerNumber) {
                        customizationDetails += `<li>Name/Number: ${item.playerName || ''} #${item.playerNumber || ''}</li>`;
                    }
                    if (item.patches && item.patches.length > 0) {
                        customizationDetails += `<li>Patches: ${item.patches.join(', ')}</li>`;
                    }
                    const orderDate = new Date(item.timestamp).toLocaleString();

                    itemEl.innerHTML = `
                        <div class="cart-item-image">${item.product.image}</div>
                        <div class="cart-item-details">
                            <h4 class="product-name">${item.product.name}</h4>
                            <div class="cart-item-customization">
                                <ul>${customizationDetails || '<li>Standard Jersey</li>'}</ul>
                                <div style="font-size: var(--text-xs); color: var(--text-muted); margin-top: var(--space-2);">Ordered on: ${orderDate}</div>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="product-price">${item.price} AED</div>
                            <div style="margin-top: var(--space-2); font-size: var(--text-sm); color: var(--accent-blue);">Status: Shipped</div>
                        </div>
                    `;
                    orderItemsContainer.appendChild(itemEl);
                });
            }
            closeAccountDropdown();
            showModal('ordersModal');
        }

        function showCartModal() {
            const cartItemsContainer = document.getElementById('cartItemsContainer');
            const cartTotalEl = document.getElementById('cartTotal');
            cartItemsContainer.innerHTML = '';
            let total = 0;

            if (cart.length === 0) {
                cartItemsContainer.innerHTML = `
                    <div class="empty-wishlist">
                        <i class="fas fa-shopping-cart"></i>
                        <h3>Your cart is empty</h3>
                        <p>Add some jerseys to get started!</p>
                    </div>
                `;
            } else {
                cart.forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'cart-item';
                    itemEl.dataset.cartItemId = item.id;

                    let customizationDetails = '';
                    if (item.playerName || item.playerNumber) {
                        customizationDetails += `<li>Name/Number: ${item.playerName || ''} #${item.playerNumber || ''}</li>`;
                    }
                    if (item.patches.length > 0) {
                        customizationDetails += `<li>Patches: ${item.patches.join(', ')}</li>`;
                    }

                    itemEl.innerHTML = `
                        <div class="cart-item-image">${item.product.image}</div>
                        <div class="cart-item-details">
                            <h4 class="product-name">${item.product.name}</h4>
                            <div class="cart-item-customization">
                                <ul>${customizationDetails || '<li>Standard Jersey</li>'}</ul>
                            </div>
                            <div class="quantity-selector">
                                <button class="quantity-btn" data-action="decrease-qty">-</button>
                                <span class="quantity-value">${item.quantity}</span>
                                <button class="quantity-btn" data-action="increase-qty">+</button>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="product-price">${item.price * item.quantity} AED</div>
                            <button class="btn btn-ghost" data-action="remove-item" style="margin-top: var(--space-2); padding: var(--space-1) var(--space-2);">
                                <i class="fas fa-trash"></i> Remove
                            </button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(itemEl);
                    total += item.price * item.quantity;
                });
            }

            cartTotalEl.textContent = `${total} AED`;
            showModal('cartModal');
        }

        function handleCartActions(event) {
            const target = event.target.closest('[data-action]');
            if (!target) return;

            const cartItemEl = target.closest('.cart-item');
            if (!cartItemEl) return;

            const cartItemId = parseInt(cartItemEl.dataset.cartItemId);
            const action = target.dataset.action;

            if (action === 'increase-qty') {
                updateCartQuantity(cartItemId, 1);
            } else if (action === 'decrease-qty') {
                updateCartQuantity(cartItemId, -1);
            } else if (action === 'remove-item') {
                removeFromCart(cartItemId);
            }
        }

        // Account Functions
        function updateAccountDropdown() {
            const userData = JSON.parse(localStorage.getItem('userData'));
            const accountBtnText = accountBtn.querySelector('span');
            const dropdownHeader = accountDropdown.querySelector('.dropdown-header h4');
            const logoutContainer = document.getElementById('logoutContainer');

            if (userData && userData.name) {
                const firstName = userData.name.split(' ')[0];
                if (accountBtnText) accountBtnText.textContent = `Hi, ${firstName}`;
                if (dropdownHeader) dropdownHeader.textContent = `Welcome, ${userData.name}`;

                logoutContainer.innerHTML = `
                    <a href="#" class="dropdown-item" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Log Out</span>
                    </a>
                `;
                document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            } else {
                if (accountBtnText) accountBtnText.textContent = 'Account';
                if (dropdownHeader) dropdownHeader.textContent = 'My Account';
                logoutContainer.innerHTML = '';
            }
        }

        function handleLogout(e) {
            e.preventDefault();
            localStorage.removeItem('userData');
            localStorage.removeItem('discountCodes');
            localStorage.removeItem('hasVisited');
            showToast('You have been logged out.', 'fas fa-sign-out-alt');
            closeAccountDropdown();
            updateAccountDropdown();
            updateDiscountCodes();
        }

        // Modal Functions
        function openQuickView(productId, event) {
            if (event) {
                event.stopPropagation();
            }

            const product = products.find(p => p.id === productId);
            if (!product) return;

            document.getElementById('quickViewTitle').textContent = product.name;
            document.getElementById('quickViewTeam').textContent = product.team;
            document.getElementById('quickViewImage').innerHTML = `
                <div style="font-size: 6rem; margin-bottom: var(--space-4);">${product.image}</div>
                <h4>${product.name}</h4>
            `;
            document.getElementById('basePrice').textContent = `${product.price} AED`;
            document.getElementById('totalPrice').textContent = `${product.price} AED`;

            // Reset form
            document.getElementById('playerName').value = '';
            document.getElementById('playerNumber').value = '';
            document.getElementById('customerNote').value = '';
            document.getElementById('nameNumberLine').style.display = 'none';
            document.getElementById('patchesLine').style.display = 'none';

            // Reset patches
            selectedPatches.clear();
            document.querySelectorAll('.patch-option').forEach(patch => {
                patch.classList.remove('selected');
            });

            // Show/hide UCL stars patch based on team
            const championsStarsPatch = document.querySelector('[data-patch="champions-stars"]');
            if (championsStarsPatch) {
                if (product.hasUcl && product.uclStars > 0) {
                    championsStarsPatch.style.display = 'block';
                    championsStarsPatch.querySelector('.patch-name').textContent = `UCL ${product.uclStars} Stars`;
                } else {
                    championsStarsPatch.style.display = 'none';
                }
            }

            // Store current product
            quickViewModal.dataset.productId = productId;

            addRecentlyViewed(productId);
            showModal('quickViewModal');
        }

        function handleProductGridClick(event) {
            const target = event.target;
            const actionButton = target.closest('[data-action]');
            if (!actionButton) return;

            const productCard = target.closest('.product-card');
            if (!productCard) return;

            const productId = parseInt(productCard.dataset.productId);
            const action = actionButton.dataset.action;

            if (action === 'wishlist') {
                toggleWishlist(productId, event);
            } else if (action === 'quick-view') {
                openQuickView(productId, event);
            }
        }

        function showWelcomeModal() {
            showModal('welcomeModal');
        }

        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('show');
            document.body.classList.add('modal-open');
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('show');

            // Only remove modal-open if no other modals are open
            const openModals = document.querySelectorAll('.modal.show');
            if (openModals.length <= 1) {
                document.body.classList.remove('modal-open');
            }
        }

        function closeAccountDropdown() {
            accountDropdown.classList.remove('show');
        }

        // Chatbot Functions
        function toggleChatbot() {
            chatbotWindow.classList.toggle('show');
        }

        function closeChatbot() {
            chatbotWindow.classList.remove('show');
        }

        function sendMessage() {
            const message = chatbotInput.value.trim();
            if (!message) return;

            // Add user message
            addMessage(message, true);
            chatbotInput.value = '';

            // Simulate bot response
            setTimeout(() => {
                const response = getBotResponse(message);
                addMessage(response, false);
            }, 1000);
        }

        function addMessage(content, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : ''}`;
            messageDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-${isUser ? 'user' : 'robot'}"></i>
                </div>
                <div class="message-content">${content}</div>
            `;
            chatbotMessages.appendChild(messageDiv);
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        }

        // --- START: Revamped Chatbot Intelligence ---

        const botDisclaimer = `<br><br><strong>⚠️ Disclaimer:</strong> I'm a bot assistant. For complex issues or the most accurate information, please contact our human support team via WhatsApp or Instagram.`;

        const handleSizeQuery = (msg, disclaimer) => {
            const heightMatch = msg.match(/(\d{3,})\s*cm/);
            if (heightMatch) {
                const height = parseInt(heightMatch[1]);
                let recommendedSize = "2XL";
                if (height < 165) recommendedSize = "S";
                else if (height < 170) recommendedSize = "M";
                else if (height < 175) recommendedSize = "L";
                else if (height < 180) recommendedSize = "XL";
                return `Based on your height of ${height}cm, I'd suggest a size ${recommendedSize}. You can also check the full measurements by clicking the "Size Guide" button on the page. ${disclaimer}`;
            }
            return `We offer sizes from S to 2XL. The best way to find your fit is to click the "Size Guide" button on the page. If you tell me your height in cm, I can give you a recommendation! ${disclaimer}`;
        };

        const handlePatchQuery = (msg, disclaimer) => {
            return `We offer a variety of official-style patches for +5 AED each, including Champions League, Europa League, Club World Cup, and more. You can see all the options in the "Patches & Badges" section when you customize a jersey. ${disclaimer}`;
        };

        const handlePriceQuery = (msg, disclaimer) => {
            return `Our premium player version jerseys start at 75 AED. Full customization with a name and number is an additional 15 AED, and each patch is 5 AED. ${disclaimer}`;
        };

        const handleShippingQuery = (msg, disclaimer) => {
            return `We deliver across the UAE! Standard delivery usually takes 2-3 business days. We also offer express options if you need your kit faster. For international shipping, please contact our support team. ${disclaimer}`;
        };

        const handlePaymentQuery = (msg, disclaimer) => {
            return `We accept Cash on Delivery, as well as all major credit/debit cards, Apple Pay, and Google Pay for secure online payments.`;
        };

        const handleReturnQuery = (msg, disclaimer) => {
            return `We have a 7-day return policy for non-customized items. Unfortunately, once a jersey is customized with a name or number, it cannot be returned unless there is a manufacturing defect. ${disclaimer}`;
        };

        const handleQualityQuery = (msg, disclaimer) => {
            return `We specialize in premium "player version" jerseys. They are designed for a slim, athletic fit with high-quality, breathable materials, just like the pros wear on the pitch.`;
        };

        const handleContactQuery = (msg, disclaimer) => {
            return `The best way to reach our team is via WhatsApp at +971 50 123 4567 or on Instagram @GoKit.ME. We're ready to help!`;
        };

        const handleDiscountQuery = (msg, disclaimer) => {
            return `Absolutely! New customers get a 10% discount code for their first 3 orders when they sign up. Keep an eye on our Instagram for special promotions, especially around big match days!`;
        };

        const handleUclQuery = (msg, disclaimer) => {
            const uclTeams = products.filter(p => p.hasUcl && p.uclStars > 0).map(p => `${p.team} (${p.uclStars} titles)`).join(', ');
            return `We love the Champions League! You can add the iconic starball patch to any UCL team's jersey. For teams that have won the title, like Real Madrid (14) or AC Milan (7), you can add a special patch with the number of titles. ${disclaimer}`;
        };

        const handleCustomizationQuery = (msg, disclaimer) => {
            return `You can customize your jersey with any name and number for just +15 AED. We use official-style fonts to make it look authentic. You can add this in the customization pop-up for any jersey.`;
        };

        const handleOrderTrackingQuery = (msg, disclaimer) => {
            return `I can't track orders myself just yet, but once your order is shipped, you'll receive a tracking number via email or SMS. If you have any issues, our support team on WhatsApp can help you out. ${disclaimer}`;
        };

        const handleProductSearchQuery = (msg, disclaimer) => {
            const keywords = ['have', 'looking for', 'search for', 'find'];
            let query = msg;
            for (const keyword of keywords) {
                query = query.replace(keyword, '').trim();
            }
            const foundProducts = products.filter(p => p.name.toLowerCase().includes(query) || p.team.toLowerCase().includes(query));
            if (foundProducts.length > 0) {
                return `Yes, we have kits for ${query}! You can use the main search bar at the top of the page to see all available options.`;
            }
            return `I couldn't find a specific match for "${query}" right now. You can try searching for the team or player in the main search bar. If we don't have it, let our team know on Instagram – we're always taking requests! ${disclaimer}`;
        };

        const knowledgeBase = [
            { keywords: ['size', 'sizing', 'fit', 'tall', 'height'], handler: handleSizeQuery },
            { keywords: ['patch', 'badge', 'tag'], handler: handlePatchQuery },
            { keywords: ['price', 'cost', 'how much'], handler: handlePriceQuery },
            { keywords: ['shipping', 'delivery', 'when will i get'], handler: handleShippingQuery },
            { keywords: ['payment', 'pay', 'cash', 'card'], handler: handlePaymentQuery },
            { keywords: ['return', 'refund', 'exchange'], handler: handleReturnQuery },
            { keywords: ['quality', 'material', 'authentic'], handler: handleQualityQuery },
            { keywords: ['contact', 'whatsapp', 'instagram', 'call', 'email'], handler: handleContactQuery },
            { keywords: ['discount', 'offer', 'promo', 'code'], handler: handleDiscountQuery },
            { keywords: ['ucl', 'champions league', 'star'], handler: handleUclQuery },
            { keywords: ['custom', 'name', 'number'], handler: handleCustomizationQuery },
            { keywords: ['track', 'order status', 'where is my order'], handler: handleOrderTrackingQuery },
            { keywords: ['hello', 'hi', 'hey'], handler: () => `Hello there! Ready to talk kits? How can I help?` },
            { keywords: ['have', 'looking for', 'search for', 'find'], handler: handleProductSearchQuery }
        ];

        function getBotResponse(message) {
            const lowerMessage = message.toLowerCase();

            for (const item of knowledgeBase) {
                if (item.keywords.some(keyword => lowerMessage.includes(keyword))) {
                    return item.handler(lowerMessage, botDisclaimer);
                }
            }

            // Fallback response
            return `I'm not sure I understand that. I can help with questions about sizing, shipping, prices, and products. Could you try rephrasing? ${botDisclaimer}`;
        }

        // --- END: Revamped Chatbot Intelligence ---

        // Form Functions
        function handleWelcomeForm(e) {
            e.preventDefault();

            const formData = {
                name: document.getElementById('welcomeName').value,
                email: document.getElementById('welcomeEmail').value,
                phone: document.getElementById('welcomePhone').value,
                jerseyRequest: document.getElementById('jerseyRequest').value
            };

            // Save user data
            localStorage.setItem('userData', JSON.stringify(formData));
            localStorage.setItem('hasVisited', 'true');

            // Generate discount code
            const discountCode = generateDiscountCode();
            localStorage.setItem('discountCodes', JSON.stringify([discountCode]));

            // Save to Firebase if available
            if (window.db) {
                try {
                    window.db.collection('users').add({
                        ...formData,
                        discountCode: discountCode,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } catch (error) {
                    console.log('Firebase save error:', error);
                }
            }

            closeModal('welcomeModal');
            showToast(`Welcome ${formData.name}! Your discount code: ${discountCode}`, 'fas fa-gift');
            updateDiscountCodes();
            updateAccountDropdown();
        }

        // Patch Functions
        function togglePatch(patchElement) {
            const patchId = patchElement.dataset.patch;
            const patchPrice = parseInt(patchElement.dataset.price);

            if (selectedPatches.has(patchId)) {
                selectedPatches.delete(patchId);
                patchElement.classList.remove('selected');
            } else {
                selectedPatches.add(patchId);
                patchElement.classList.add('selected');
            }

            updatePrice();
        }

        function updatePrice() {
            const playerName = document.getElementById('playerName').value;
            const playerNumber = document.getElementById('playerNumber').value;
            const basePrice = parseInt(document.getElementById('basePrice').textContent);

            let totalPrice = basePrice;
            const nameNumberLine = document.getElementById('nameNumberLine');
            const patchesLine = document.getElementById('patchesLine');

            // Name & Number pricing
            if (playerName || playerNumber) {
                totalPrice += 15;
                nameNumberLine.style.display = 'flex';
            } else {
                nameNumberLine.style.display = 'none';
            }

            // Patches pricing
            const patchCount = selectedPatches.size;
            if (patchCount > 0) {
                const patchesTotal = patchCount * 5; // 5 AED per patch
                document.getElementById('patchCount').textContent = patchCount;
                document.getElementById('patchesPrice').textContent = `${patchesTotal} AED`;
                patchesLine.style.display = 'flex';
                totalPrice += patchesTotal;
            } else {
                patchesLine.style.display = 'none';
            }

            document.getElementById('totalPrice').textContent = `${totalPrice} AED`;
        }

        function addToCart() {
            const productId = parseInt(quickViewModal.dataset.productId);
            const product = products.find(p => p.id === productId);

            const cartItem = {
                id: Date.now(),
                productId: productId,
                product: product,
                playerName: document.getElementById('playerName').value,
                playerNumber: document.getElementById('playerNumber').value,
                patches: Array.from(selectedPatches),
                customerNote: document.getElementById('customerNote').value,
                price: parseInt(document.getElementById('totalPrice').textContent),
                quantity: 1,
                timestamp: new Date().toISOString()
            };

            cart.push(cartItem);
            localStorage.setItem('cart', JSON.stringify(cart));

            // Save to Firebase cart if a user is logged in
            if (window.db && window.auth.currentUser) {
                const userId = window.auth.currentUser.uid;
                try {
                    // This saves the item to a 'cart' subcollection for the logged-in user.
                    // This is much better than creating a premature 'order'.
                    // We use the cartItem.id as the document ID to make it easy to find/update.
                    window.db.collection('users').doc(userId).collection('cart').doc(cartItem.id.toString()).set({
                        ...cartItem,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } catch (error) {
                    console.log('Firebase cart save error:', error);
                }
            }

            closeModal('quickViewModal');
            animateAddToCart();
        }

        function updateCartQuantity(cartItemId, change) {
            const itemIndex = cart.findIndex(item => item.id === cartItemId);
            if (itemIndex > -1) {
                const item = cart[itemIndex];
                item.quantity += change;
                const shouldRemove = item.quantity <= 0;

                if (shouldRemove) {
                    cart.splice(itemIndex, 1); // Remove from local cart array
                }

                // Always update local storage first for a responsive UI
                localStorage.setItem('cart', JSON.stringify(cart));
                showCartModal(); // Re-render the modal with new quantities
                updateCartIcon();

                // Sync changes with Firebase if user is logged in
                if (window.db && window.auth.currentUser) {
                    const userId = window.auth.currentUser.uid;
                    const cartDocRef = window.db.collection('users').doc(userId).collection('cart').doc(cartItemId.toString());

                    if (shouldRemove) {
                        cartDocRef.delete().catch(error => console.error("Error removing item from Firebase cart: ", error));
                    } else {
                        cartDocRef.update({ quantity: item.quantity }).catch(error => console.error("Error updating item in Firebase cart: ", error));
                    }
                }
            }
        }

        function removeFromCart(cartItemId) {
            cart = cart.filter(item => item.id !== cartItemId);
            localStorage.setItem('cart', JSON.stringify(cart));
            showCartModal(); // Re-render the modal
            updateCartIcon();
            showToast('Item removed from cart', 'fas fa-trash');

            // Sync deletion with Firebase if user is logged in
            if (window.db && window.auth.currentUser) {
                const userId = window.auth.currentUser.uid;
                window.db.collection('users').doc(userId).collection('cart').doc(cartItemId.toString()).delete()
                    .catch(error => console.error("Error removing item from Firebase cart: ", error));
            }
        }

        // Utility Functions
        function debounce(func, delay) {
            let timeoutId;
            return function (...args) {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => {
                    func.apply(this, args);
                }, delay);
            };
        }

        function generateDiscountCode() {
            const codes = ['WELCOME10', 'FIRST10', 'GOKIT10', 'NEWBIE10', 'START10'];
            return codes[Math.floor(Math.random() * codes.length)];
        }

        function updateDiscountCodes() {
            const codes = JSON.parse(localStorage.getItem('discountCodes')) || [];
            const codesList = document.getElementById('discountCodesList');

            if (codes.length > 0) {
                codesList.innerHTML = codes.map(code => `
                    <div class="dropdown-item">
                        <i class="fas fa-tag"></i>
                        <span>${code} - 10% OFF</span>
                    </div>
                `).join('');
            }
        }

        function showToast(message, icon) {
            const toast = document.createElement('div');
            toast.className = 'toast-notification';
            toast.innerHTML = `
                <i class="${icon}"></i>
                <span>${message}</span>
            `;

            document.body.appendChild(toast);

            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // Recently Viewed Functions
        function addRecentlyViewed(productId) {
            let viewed = JSON.parse(localStorage.getItem('recentlyViewed')) || [];
            // Remove if already exists to move it to the front
            viewed = viewed.filter(id => id !== productId);
            // Add to the front
            viewed.unshift(productId);
            // Keep only the last 5 items
            if (viewed.length > 5) {
                viewed.pop();
            }
            localStorage.setItem('recentlyViewed', JSON.stringify(viewed));
            renderRecentlyViewed(); // Re-render the section
        }

        function renderRecentlyViewed() {
            const viewedIds = JSON.parse(localStorage.getItem('recentlyViewed')) || [];
            recentlyViewedGrid.innerHTML = '';

            if (viewedIds.length > 0) {
                viewedIds.forEach(id => {
                    const product = products.find(p => p.id === id);
                    if (product) {
                        const card = createProductCard(product);
                        recentlyViewedGrid.appendChild(card);
                    }
                });
            }
        }

        // Initialize discount codes on load
        updateDiscountCodes();
    </script>
</body>

</html>